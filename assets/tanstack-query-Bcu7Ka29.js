import{Q as t,h as e,s as r,d as n}from"./vendor-oroydawa.js";import{i as a,o as s,c as i,d as o,f as u,u as c,h as l,A as d,B as f,C as p,j as h,l as m,E as v,F as y}from"./solid-DsUIy2vl.js";var g=o(void 0),O=t=>(a(e=>(e?.(),t.client.mount(),t.client.unmount.bind(t.client))),s(()=>t.client.unmount()),i(g.Provider,{value:()=>t.client,get children(){return t.children}})),w=o(()=>!1);w.Provider;function Q(t,n,a){const i=u(()=>(t=>{if(t)return t;const e=c(g);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e()})(a?.())),o=c(w),O=u(()=>{const e=i().defaultQueryOptions(t());return e._optimisticResults=o()?"isRestoring":"optimistic",e.structuralSharing=!1,e}),Q=O(),[R,C]=l(new n(i(),O()));let D=R().getOptimisticResult(O());const[P,E]=d(D),b=()=>R().subscribe(t=>{D=t,queueMicrotask(()=>{q&&k()})});function j(t){const e=R().options,r=e.reconcile;E(n=>function(t,e,r){if(!1===r)return e;if("function"==typeof r){const n=r(t.data,e.data);return{...e,data:n}}let n=e.data;if(void 0===t.data)try{n=structuredClone(n)}catch(s){}const a=y(n,{key:r})(t.data);return{...e,data:a}}(n,t,void 0!==r&&r,e.queryHash))}let q=null,x=null;const[S,{refetch:k}]=f(()=>{const t=R();return new Promise((e,n)=>(x=e,q||o()||(q=b()),t.updateResult(),D.isError&&!D.isFetching&&!o()&&r(t.options.throwOnError,[D.error,t.getCurrentQuery()])?(j(D),n(D.error)):D.isLoading?void j(D):(x=null,e((t.getCurrentQuery(),D)))))},{storage:function(){return[()=>P,t=>{const e=v(P);if("function"==typeof t&&(t=t(e)),t?.hydrationData){const{hydrationData:e,...r}=t;t=r}j(t)}]},get deferStream(){return t().deferStream},onHydrated(t,r){if(r.value&&"hydrationData"in r.value&&e(i(),{queries:[{...r.value.hydrationData}]}),q)return;const n={...Q};!Q.staleTime&&Q.initialData||!r.value||(n.refetchOnMount=!1),R().setOptions(n),j(R().getOptimisticResult(n)),q=b()}});p(h(i,t=>{q&&q();const e=new n(t,O());q=b(),C(e)},{defer:!0})),p(h(o,t=>{t||m||k()},{defer:!0})),s(()=>{q&&(q(),q=null),x&&!m&&(x(D),x=null)}),p(h([R,O],([t,e])=>{t.setOptions(e),j(t.getOptimisticResult(e)),k()},{defer:!0}));return new Proxy(P,{get:(t,e)=>"data"===e?void 0!==P.data?S.latest?.data:S()?.data:Reflect.get(t,e)})}function R(t,e){return Q(u(()=>t()),n,e)}var C=class extends t{constructor(t={}){super(t)}};export{C as Q,O as a,R as u};
