import{Q as M,h as B,s as F,d as I}from"./vendor-D1BJNWig.js";import{f as T,o as O,c as _,a as S,d as Q,u as x,e as j,x as z,y as A,z as R,h as b,j as p,A as L,B as N}from"./solid-BkqplXXh.js";var D=S(void 0),W=r=>{if(r)return r;const n=x(D);if(!n)throw new Error("No QueryClient set, use QueryClientProvider to set one");return n()},X=r=>(T(n=>(n?.(),r.client.mount(),r.client.unmount.bind(r.client))),O(()=>r.client.unmount()),_(D.Provider,{value:()=>r.client,get children(){return r.children}})),P=S(()=>!1),$=()=>x(P);P.Provider;function G(r,n,l,f){if(l===!1)return n;if(typeof l=="function"){const d=l(r.data,n.data);return{...n,data:d}}let u=n.data;if(r.data===void 0)try{u=structuredClone(u)}catch{}const o=N(u,{key:l})(r.data);return{...n,data:o}}var J=(r,n)=>n;function K(r,n,l){const f=Q(()=>W(l?.())),u=$(),o=Q(()=>{const e=f().defaultQueryOptions(r());return e._optimisticResults=u()?"isRestoring":"optimistic",e.structuralSharing=!1,e}),d=o(),[c,q]=j(new n(f(),o()));let a=c().getOptimisticResult(o());const[v,E]=z(a),g=()=>c().subscribe(t=>{a=t,queueMicrotask(()=>{s&&m()})});function y(e){const t=c().options,i=t.reconcile;E(C=>G(C,e,i===void 0?!1:i,t.queryHash))}function k(){return[()=>v,e=>{const t=L(v);if(typeof e=="function"&&(e=e(t)),e?.hydrationData){const{hydrationData:i,...C}=e;e=C}y(e)}]}let s=null,h=null;const[w,{refetch:m}]=A(()=>{const e=c();return new Promise((t,i)=>{if(h=t,!s&&!u()&&(s=g()),e.updateResult(),a.isError&&!a.isFetching&&!u()&&F(e.options.throwOnError,[a.error,e.getCurrentQuery()]))return y(a),i(a.error);if(!a.isLoading)return h=null,t(J(e.getCurrentQuery(),a));y(a)})},{storage:k,get deferStream(){return r().deferStream},onHydrated(e,t){if(t.value&&"hydrationData"in t.value&&B(f(),{queries:[{...t.value.hydrationData}]}),s)return;const i={...d};(d.staleTime||!d.initialData)&&t.value&&(i.refetchOnMount=!1),c().setOptions(i),y(c().getOptimisticResult(i)),s=g()}});R(b(f,e=>{s&&s();const t=new n(e,o());s=g(),q(t)},{defer:!0})),R(b(u,e=>{!e&&!p&&m()},{defer:!0})),O(()=>{s&&(s(),s=null),h&&!p&&(h(a),h=null)}),R(b([c,o],([e,t])=>{e.setOptions(t),y(e.getOptimisticResult(t)),m()},{defer:!0}));const H={get(e,t){return t==="data"?v.data!==void 0?w.latest?.data:w()?.data:Reflect.get(e,t)}};return new Proxy(v,H)}function Y(r,n){return K(Q(()=>r()),I,n)}var Z=class extends M{constructor(r={}){super(r)}};export{Z as Q,X as a,Y as u};
